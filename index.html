<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legends System - Fixed & Battle Edition</title>
    <style>
        :root { --gold: #ffd700; --red: #ff4d4d; --bg: #050505; --panel: #1a1a1a; }
        body { background: var(--bg); color: #e0e0e0; font-family: sans-serif; margin: 0; text-align: center; }
        .screen { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* شريط الحالة */
        .status-header { background: #111; padding: 15px; border-bottom: 3px solid var(--gold); display: flex; justify-content: space-around; position: sticky; top: 0; z-index: 1000; }
        .stat-val { color: var(--gold); font-weight: bold; }

        /* الخريطة */
        .map-frame { position: relative; display: inline-block; margin-top: 20px; border: 3px solid #333; line-height: 0; }
        .map-img { width: 100%; max-width: 850px; height: auto; border-radius: 10px; }
        .node { position: absolute; width: 11%; height: 11%; border: 3px solid var(--gold); border-radius: 50%; background: rgba(0,0,0,0.5); cursor: pointer; transform: translate(-50%, -50%); z-index: 10; }
        
        /* توزيع النقاط */
        .nc { top: 50%; left: 50%; } .n1 { top: 20%; left: 50%; } .n2 { top: 30%; left: 78%; }
        .n3 { top: 58%; left: 88%; } .n4 { top: 82%; left: 68%; } .n5 { top: 82%; left: 32%; }
        .n6 { top: 58%; left: 12%; } .n7 { top: 30%; left: 22%; }

        /* شاشة التفاعل والقتال */
        .box-view { max-width: 500px; margin: 30px auto; background: var(--panel); border: 2px solid var(--gold); border-radius: 20px; padding: 25px; }
        .dialog { background: #222; padding: 15px; border-radius: 10px; margin: 15px 0; }
        .btn { background: #333; color: white; border: 1px solid var(--gold); padding: 12px; cursor: pointer; border-radius: 8px; width: 100%; margin: 5px 0; font-weight: bold; }
        .btn:hover { background: var(--gold); color: black; }
        .btn-red { border-color: var(--red); color: var(--red); }
        .btn-red:hover { background: var(--red); color: white; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen active">
        <div style="margin-top: 80px; display: inline-block; background: #111; padding: 30px; border: 2px solid var(--gold); border-radius: 15px;">
            <h2>تسجيل دخول البطل</h2>
            <select id="char-select">
                <option value="ديابلو">ديابلو</option>
                <option value="ريمورو">ريمورو</option>
            </select>
            <input type="password" id="pass-field" placeholder="كلمة السر (123)">
            <button class="btn" style="background: var(--gold); color: black;" onclick="login()">دخول</button>
        </div>
    </div>

    <div id="map-screen" class="screen">
        <div class="status-header">
            <div>البطل: <span id="st-char" class="stat-val"></span></div>
            <div>الذهب: <span id="st-gold" class="stat-val"></span></div>
            <div>خزنة البنك: <span id="st-bank" class="stat-val">0</span></div>
        </div>
        <div class="map-frame">
            <img src="20260129_152721.jpg" class="map-img">
            <div class="node nc" onclick="openNPC('guild')"></div>
            <div class="node n1" onclick="openNPC('bank')"></div>
            <div class="node n2" onclick="openNPC('battle')"></div>
        </div>
        <p>المركز (النقابة) | الأعلى (البنك) | اليمين العلوي (قتال وحوش)</p>
    </div>

    <div id="npc-screen" class="screen">
        <div class="box-view">
            <h2 id="npc-name" style="color: var(--gold);"></h2>
            <div id="npc-dialog" class="dialog"></div>
            <div id="npc-actions"></div>
            <button class="btn" style="margin-top: 20px; opacity: 0.7;" onclick="showMap()">العودة للخريطة</button>
        </div>
    </div>

    <script>
        let state = { char: "", gold: 100, bank: 0, hp: 1000 };
        const PASS = { "ديابلو": "123", "ريمورو": "456" };

        function login() {
            const c = document.getElementById('char-select').value;
            const p = document.getElementById('pass-field').value;
            if(PASS[c] === p) {
                state.char = c;
                updateUI();
                showMap();
            } else { alert("كلمة السر خاطئة!"); }
        }

        function openNPC(type) {
            const name = document.getElementById('npc-name');
            const dial = document.getElementById('npc-dialog');
            const acts = document.getElementById('npc-actions');
            acts.innerHTML = "";

            if(type === 'bank') {
                name.innerText = "خزنة البنك الملكي";
                dial.innerText = `رصيدك الحالي في الخزنة: ${state.bank} ذهبة. ماذا تريد أن تفعل؟`;
                addBtn(acts, "إيداع 50 ذهبة", () => deposit(50));
                addBtn(acts, "سحب كل المدخرات", () => withdraw());
            } 
            else if(type === 'battle') {
                name.innerText = "منطقة الوحوش";
                dial.innerText = "ظهر 'عنكبوت الهاوية'! إنه يحرس كنوزاً صغيرة.";
                addBtn(acts, "هجوم: نهاية العالم (500 ضرر)", () => fightEnemy(500), true);
            }
            else if(type === 'guild') {
                name.innerText = "نقابة الأبطال";
                dial.innerText = "أهلاً بك يا ديابلو في المركز. هل تبحث عن عمل؟";
                addBtn(acts, "طلب مهمة (قريباً)", () => alert("المهمات تحت الإنشاء"));
            }
            switchScreen('npc-screen');
        }

        // دالة إصلاح البنك
        function deposit(amt) {
            if(state.gold >= amt) {
                state.gold -= amt;
                state.bank += amt;
                updateUI();
                openNPC('bank'); // تحديث الشاشة لرؤية الرقم الجديد
            } else { alert("ليس لديك ذهب كافٍ!"); }
        }

        function withdraw() {
            if(state.bank > 0) {
                state.gold += state.bank;
                state.bank = 0;
                updateUI();
                openNPC('bank');
            } else { alert("الخزنة فارغة فعلاً!"); }
        }

        // نظام الوحوش والقتال
        function fightEnemy(dmg) {
            let loot = Math.floor(Math.random() * 50) + 10;
            state.gold += loot;
            updateUI();
            alert(`لقد سحقت الوحش بمهارة نهاية العالم! حصلت على ${loot} ذهبة.`);
            showMap();
        }

        function addBtn(parent, text, func, isRed = false) {
            const b = document.createElement('button');
            b.className = isRed ? "btn btn-red" : "btn";
            b.innerText = text;
            b.onclick = func;
            parent.appendChild(b);
        }

        function updateUI() {
            document.getElementById('st-char').innerText = state.char;
            document.getElementById('st-gold').innerText = state.gold;
            document.getElementById('st-bank').innerText = state.bank;
        }

        function showMap() { switchScreen('map-screen'); }
        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>

