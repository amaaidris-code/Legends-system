<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legends System - Diablo vs Gyutaro</title>
    <style>
        :root { --gold: #ffd700; --red: #ff4d4d; --bg: #050505; --panel: rgba(20, 20, 20, 0.95); }
        body { background: var(--bg); color: white; font-family: 'Cairo', sans-serif; margin: 0; overflow: hidden; }
        
        /* شاشات اللعبة */
        .screen { display: none; height: 100vh; width: 100vw; position: relative; animation: fadeIn 0.6s ease; }
        .active { display: flex; flex-direction: column; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* البطاقة الجانبية (رخصة ديابلو) */
        .license-card { 
            position: fixed; left: -280px; top: 80px; width: 260px; 
            background: linear-gradient(135deg, #1a1a1a, #000); border: 2px solid var(--gold); 
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 2000; padding: 15px; border-radius: 0 20px 20px 0;
            box-shadow: 5px 0 15px rgba(255, 215, 0, 0.2);
        }
        .license-card.open { left: 0; }
        .license-toggle { 
            position: absolute; right: -40px; top: 20px; width: 40px; height: 110px; 
            background: var(--gold); color: black; writing-mode: vertical-rl; 
            cursor: pointer; border-radius: 0 10px 10px 0; font-weight: bold; text-align: center;
        }

        /* واجهة القتال السينمائية */
        .battle-arena { flex: 1; display: flex; justify-content: space-around; align-items: center; background: radial-gradient(circle, #222, #050505); padding: 20px; }
        .char-box { text-align: center; width: 40%; transition: 0.3s; }
        .char-img { width: 180px; height: 180px; border-radius: 50%; border: 4px solid var(--gold); box-shadow: 0 0 20px var(--gold); object-fit: cover; background: #111; }
        .enemy-img { border-color: var(--red); box-shadow: 0 0 20px var(--red); }
        
        /* أشرطة الطاقة */
        .bar-container { width: 100%; background: #333; height: 25px; border-radius: 12px; margin: 10px 0; border: 2px solid #555; position: relative; overflow: hidden; }
        .bar-fill { height: 100%; width: 100%; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .hp-player { background: linear-gradient(90deg, #00ff00, #004400); }
        .hp-enemy { background: linear-gradient(90deg, #ff0000, #440000); }
        .bar-text { position: absolute; width: 100%; text-align: center; top: 2px; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 2px black; }

        /* سجل المهارات */
        .skill-log { background: rgba(0,0,0,0.8); border: 1px solid #333; height: 100px; margin: 10px 20px; padding: 10px; border-radius: 10px; overflow-y: auto; color: #aaa; font-size: 14px; }

        /* لوحة التحكم بالمهارات */
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; background: #111; border-top: 3px solid var(--gold); }
        .skill-btn { 
            background: #222; border: 1px solid var(--gold); color: white; padding: 15px; 
            border-radius: 12px; cursor: pointer; position: relative; overflow: hidden;
        }
        .skill-btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #444; }
        .cooldown-overlay { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.7); color: var(--red); font-weight: bold; }

        /* البنك والمتجر */
        .npc-panel { margin: auto; background: var(--panel); border: 2px solid var(--gold); border-radius: 20px; padding: 40px; width: 80%; max-width: 500px; box-shadow: 0 0 50px black; }
        .action-btn { background: var(--gold); color: black; border: none; padding: 15px; width: 100%; margin: 10px 0; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="license" class="license-card">
        <div class="license-toggle" onclick="document.getElementById('license').classList.toggle('open')">رخصة المغامر ☰</div>
        <h3 style="color: var(--gold); margin-top: 0;">ID: ديابلو</h3>
        <p>الرتبة: شيطان أسطوري</p>
        <p>الذهب الميداني: <span id="lic-gold" style="color: gold;">100</span></p>
        <p>رصيد البنك: <span id="lic-bank" style="color: #00ff00;">0</span></p>
        <hr border="1">
        <h4>المخزن (Inventory)</h4>
        <p id="lic-potions">جرعات الشفاء: 0</p>
    </div>

    <div id="login-screen" class="screen active" style="justify-content: center; align-items: center;">
        <div class="npc-panel">
            <h1 style="color: var(--gold);">نظام الأساطير</h1>
            <input type="password" id="pass-input" placeholder="الرمز السري لدخول ديابلو" style="width: 100%; padding: 15px; margin: 10px 0; background: #000; color: white; border: 1px solid gold; box-sizing: border-box;">
            <button class="action-btn" onclick="checkAuth()">تحقق من الهوية</button>
        </div>
    </div>

    <div id="map-screen" class="screen">
        <div style="padding: 20px; background: #111; border-bottom: 2px solid var(--gold); display: flex; justify-content: space-between;">
            <span>مرحباً بك يا سيد الشياطين</span>
            <span style="color: gold;">$ <span id="map-gold">100</span></span>
        </div>
        <div style="flex: 1; position: relative; text-align: center; padding-top: 20px;">
            <div style="position: relative; display: inline-block;">
                <img src="20260129_152721.jpg" style="max-width: 90%; border: 3px solid #333; border-radius: 15px;">
                <div style="position: absolute; top:20%; left:50%; width: 60px; height: 60px; border: 3px solid gold; border-radius: 50%; cursor: pointer;" onclick="uiBank()"></div>
                <div style="position: absolute; top:30%; left:78%; width: 60px; height: 60px; border: 3px solid red; border-radius: 50%; cursor: pointer;" onclick="uiBattle()"></div>
                <div style="position: absolute; top:58%; left:88%; width: 60px; height: 60px; border: 3px solid gold; border-radius: 50%; cursor: pointer;" onclick="uiShop()"></div>
            </div>
        </div>
    </div>

    <div id="battle-screen" class="screen">
        <div class="battle-arena">
            <div class="char-box" id="player-box">
                <img src="https://i.imgur.com/your-diablo-image.png" class="char-img" alt="Diablo">
                <h3>ديابلو</h3>
                <div class="bar-container">
                    <div id="p-hp-bar" class="bar-fill hp-player"></div>
                    <div class="bar-text" id="p-hp-text">1000/1000</div>
                </div>
            </div>
            
            <div style="font-size: 40px; color: var(--gold); font-weight: bold; font-style: italic;">VS</div>

            <div class="char-box" id="enemy-box">
                <img src="https://i.imgur.com/your-gyutaro-image.png" class="char-img enemy-img" alt="Gyutaro">
                <h3 id="e-name">غيوتارو</h3>
                <div class="bar-container">
                    <div id="e-hp-bar" class="bar-fill hp-enemy"></div>
                    <div class="bar-text" id="e-hp-text">1500/1500</div>
                </div>
            </div>
        </div>

        <div class="skill-log" id="battle-log">اللقاء الأول.. القدر يبتسم لديابلو.</div>

        <div class="controls">
            <button id="btn-atk" class="skill-btn" onclick="useSkill('atk')">
                <b>نهاية العالم</b><br><small>ضربة لا تُصد</small>
                <div id="cd-atk" class="cooldown-overlay" style="height: 0%;"></div>
            </button>
            <button id="btn-shd" class="skill-btn" onclick="useSkill('shd')">
                <b>حاجز الهاوية</b><br><small>تعزيز الدفاع</small>
                <div id="cd-shd" class="cooldown-overlay" style="height: 0%;"></div>
            </button>
            <button id="btn-heal" class="skill-btn" onclick="useItem()">
                <b>جرعة شفاء</b><br><small id="pot-count">0 متوفر</small>
            </button>
        </div>
    </div>

    <div id="npc-screen" class="screen" style="justify-content: center; align-items: center;">
        <div class="npc-panel">
            <h2 id="npc-title" style="color: var(--gold);"></h2>
            <p id="npc-msg" style="white-space: pre-line;"></p>
            <div id="npc-btns"></div>
            <button class="action-btn" style="background: #333; color: white;" onclick="switchS('map-screen')">عودة للخريطة</button>
        </div>
    </div>

    <script>
        // نظام التشفير للرمز السري
        const _0xKEY = "MTIz"; 
        let game = { gold: 100, bank: 0, hp: 1000, mhp: 1000, pots: 0, prot: false, lock: false };
        let enemy = { name: "غيوتارو", hp: 1500, mhp: 1500 };
        let cds = { atk: 0, shd: 0 };

        function checkAuth() {
            if(btoa(document.getElementById('pass-input').value) === _0xKEY) switchS('map-screen');
            else alert("الرمز خاطئ يا متسلل!");
        }

        function updateAllUI() {
            document.getElementById('map-gold').innerText = game.gold;
            document.getElementById('lic-gold').innerText = game.gold;
            document.getElementById('lic-bank').innerText = game.bank;
            document.getElementById('lic-potions').innerText = "جرعات الشفاء: " + game.pots;
            document.getElementById('pot-count').innerText = game.pots + " متوفر";
        }

        // --- واجهة البنك ---
        function uiBank() {
            setupNPC("البنك الملكي", `رصيدك الميداني: ${game.gold}\nرصيدك في الخزنة: ${game.bank}`);
            addNPCBtn("إيداع 50 ذهبة", () => { if(game.gold >= 50){ game.gold-=50; game.bank+=50; uiBank(); updateAllUI(); } });
            addNPCBtn("سحب كل المدخرات", () => { game.gold+=game.bank; game.bank=0; uiBank(); updateAllUI(); });
        }

        // --- واجهة المتجر ---
        function uiShop() {
            setupNPC("التاجر الجوال", "جرعة شفاء ملكية (+400 HP)\nالسعر: 50 ذهب");
            addNPCBtn("شراء (50 ذهب)", () => { if(game.gold >= 50){ game.gold-=50; game.pots++; uiShop(); updateAllUI(); } });
        }

        // --- نظام القتال السينمائي ---
        function uiBattle() {
            enemy.hp = enemy.mhp; game.hp = game.mhp; game.lock = false;
            cds = { atk: 0, shd: 0 };
            updateBattleBars();
            switchS('battle-screen');
        }

        function useSkill(type) {
            if(game.lock || (type === 'atk' && cds.atk > 0) || (type === 'shd' && cds.shd > 0)) return;
            game.lock = true; // قفل الهجوم لمنع السبام

            if(type === 'atk') {
                enemy.hp -= 400; logBattle("ديابلو يطلق 'نهاية العالم'! غيوتارو يتألم بشدة.");
                cds.atk = 2;
            } else if(type === 'shd') {
                game.prot = true; logBattle("ديابلو استدعى 'حاجز الهاوية'.. الدفاع مطلق.");
                cds.shd = 3;
            }
            
            updateBattleBars();
            if(enemy.hp <= 0) return winBattle();
            setTimeout(enemyTurn, 1000);
        }

        function useItem() {
            if(game.pots > 0 && !game.lock) {
                game.hp = Math.min(game.mhp, game.hp + 400);
                game.pots--;
                logBattle("ديابلو شرب جرعة الشفاء.. جراحه تلتئم.");
                game.lock = true;
                updateAllUI(); updateBattleBars();
                setTimeout(enemyTurn, 1000);
            }
        }

        function enemyTurn() {
            let dmg = game.prot ? 0 : 180;
            game.hp -= dmg; game.prot = false;
            logBattle(dmg === 0 ? "غيوتارو هجم ولكن الحاجز سحقه!" : `غيوتارو استخدم 'ماندالا الدم' وسبب ${dmg} ضرر.`);
            
            // إدارة التهدئة
            if(cds.atk > 0) cds.atk--;
            if(cds.shd > 0) cds.shd--;
            
            game.lock = false;
            updateBattleBars();
            if(game.hp <= 0) { alert("هزمت.. القوة لم تكن كافية."); switchS('map-screen'); }
        }

        function updateBattleBars() {
            document.getElementById('p-hp-bar').style.width = (game.hp/game.mhp*100) + "%";
            document.getElementById('e-hp-bar').style.width = (enemy.hp/enemy.mhp*100) + "%";
            document.getElementById('p-hp-text').innerText = `${game.hp}/${game.mhp}`;
            document.getElementById('e-hp-text').innerText = `${enemy.hp}/${enemy.mhp}`;
            
            // تحديث واجهة التهدئة بصرياً
            document.getElementById('btn-atk').disabled = (cds.atk > 0 || game.lock);
            document.getElementById('btn-shd').disabled = (cds.shd > 0 || game.lock);
            document.getElementById('cd-atk').style.height = (cds.atk/2*100) + "%";
            document.getElementById('cd-shd').style.height = (cds.shd/3*100) + "%";
        }

        function winBattle() { 
            alert("انتصر ديابلو! غيوتارو يتلاشى في العدم."); 
            game.gold += 300; updateAllUI(); switchS('map-screen'); 
        }

        // أدوات النظام
        function setupNPC(t, m) {
            document.getElementById('npc-title').innerText = t;
            document.getElementById('npc-msg').innerText = m;
            document.getElementById('npc-btns').innerHTML = "";
            switchS('npc-screen');
        }
        function addNPCBtn(t, f) {
            let b = document.createElement('button'); b.className = "action-btn"; b.innerText = t; b.onclick = f;
            document.getElementById('npc-btns').appendChild(b);
        }
        function logBattle(m) {
            const l = document.getElementById('battle-log');
            l.innerHTML = `<div>> ${m}</div>` + l.innerHTML;
        }
        function switchS(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>
