<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legends - Cinematic Battle</title>
    <style>
        :root { --gold: #ffd700; --red: #ff4d4d; --bg: #050505; }
        body { background: var(--bg); color: white; font-family: 'Cairo', sans-serif; margin: 0; overflow: hidden; }

        /* حاكم الشاشات - الانتقال السينمائي */
        #game-container { display: flex; width: 300vw; transition: transform 0.8s cubic-bezier(0.7, 0, 0.3, 1); }
        .screen { width: 100vw; height: 100vh; position: relative; flex-shrink: 0; }

        /* السهم الجانبي المطور */
        .side-panel { 
            position: fixed; right: -220px; top: 100px; width: 200px; 
            background: rgba(15,15,15,0.95); border: 2px solid var(--gold); 
            transition: 0.4s ease; z-index: 2000; padding: 15px; border-radius: 15px 0 0 15px;
        }
        .side-panel.open { right: 0; }
        .side-arrow { 
            position: absolute; left: -35px; top: 10px; width: 35px; height: 80px; 
            background: var(--gold); color: black; cursor: pointer; 
            border-radius: 10px 0 0 10px; display: flex; align-items: center; justify-content: center; font-weight: bold;
        }

        /* الخريطة والدوائر المصغرة */
        .map-frame { position: relative; display: inline-block; margin-top: 20px; border: 3px solid #222; }
        .map-img { width: 100%; max-width: 800px; border-radius: 10px; }
        .node { 
            position: absolute; width: 35px; height: 35px; /* تصغير الدوائر */
            border: 2px solid var(--gold); border-radius: 50%; 
            background: rgba(0,0,0,0.6); cursor: pointer; transform: translate(-50%, -50%); 
            transition: 0.3s; box-shadow: 0 0 10px var(--gold);
        }
        .node:hover { transform: translate(-50%, -50%) scale(1.3); background: var(--gold); }

        /* واجهة القتال السينمائية */
        .battle-arena { display: flex; justify-content: space-around; align-items: center; height: 60%; padding-top: 50px; }
        .fighter { text-align: center; width: 35%; transition: 0.5s; }
        .fighter img { width: 150px; height: 150px; border-radius: 50%; border: 3px solid var(--gold); box-shadow: 0 0 20px var(--gold); }
        .enemy img { border-color: var(--red); box-shadow: 0 0 20px var(--red); }
        
        .hp-bar { width: 100%; background: #333; height: 15px; border-radius: 10px; margin-top: 10px; overflow: hidden; border: 1px solid #555; }
        .hp-fill { height: 100%; width: 100%; transition: 0.5s; }

        /* سجل المهارات */
        .battle-log { 
            margin: 20px auto; width: 80%; height: 80px; background: rgba(0,0,0,0.8); 
            border-right: 4px solid var(--gold); padding: 10px; overflow-y: auto; font-size: 14px;
        }

        /* مهارات ديابلو في السهم الجانبي */
        .skill-item { 
            background: #222; margin: 5px 0; padding: 8px; border-radius: 5px; 
            border: 1px solid #444; font-size: 12px; cursor: pointer;
        }
        .skill-item:hover { border-color: var(--gold); }
        .cooldown { color: var(--red); float: left; font-weight: bold; }

        input { padding: 12px; border-radius: 8px; border: 1px solid var(--gold); background: #111; color: white; width: 80%; }
        .btn { background: var(--gold); color: black; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="side-panel" class="side-panel">
        <div class="side-arrow" onclick="document.getElementById('side-panel').classList.toggle('open')">◄</div>
        <div id="panel-content">
            </div>
    </div>

    <div id="game-container">
        <div id="login-screen" class="screen" style="display: flex; align-items: center; justify-content: center;">
            <div style="background: #111; padding: 40px; border: 2px solid var(--gold); border-radius: 20px; text-align: center;">
                <h1 style="color: var(--gold);">Legends Login</h1>
                <input type="password" id="pass-field" placeholder="الرمز السري">
                <button class="btn" onclick="login()">دخول العالم</button>
            </div>
        </div>

        <div id="map-screen" class="screen" style="text-align: center;">
            <div style="padding: 15px; background: #111; border-bottom: 2px solid var(--gold);">خريطة الأساطير</div>
            <div class="map-frame">
                <img src="20260129_152721.jpg" class="map-img">
                <div class="node" style="top:20%; left:50%;" onclick="alert('البنك قيد الصيانة')"></div>
                <div class="node" style="top:30%; left:78%;" onclick="goToBattle()"></div> <div class="node" style="top:58%; left:88%;" onclick="alert('المتجر قيد الصيانة')"></div>
            </div>
        </div>

        <div id="battle-screen" class="screen">
            <div class="battle-arena">
                <div class="fighter">
                    <img src="diablo_avatar.jpg" alt="Diablo">
                    <h3>ديابلو</h3>
                    <div class="hp-bar"><div id="p-hp" class="hp-fill" style="background: green;"></div></div>
                    <small id="p-hp-txt">1000/1000</small>
                </div>
                <div style="font-size: 30px; color: var(--gold);">VS</div>
                <div class="fighter enemy">
                    <img src="gyutaro_avatar.jpg" alt="Gyutaro">
                    <h3>غيوتارو</h3>
                    <div class="hp-bar"><div id="e-hp" class="hp-fill" style="background: red;"></div></div>
                    <small id="e-hp-txt">1500/1500</small>
                </div>
            </div>
            <div id="battle-log" class="battle-log">بدأت المواجهة الحتمية..</div>
            <center><button class="btn" style="background: #333; color: white;" onclick="backToMap()">انسحاب</button></center>
        </div>
    </div>

    <script>
        const _0xPASS = "MTIz";
        let state = { hp: 1000, gold: 100, bank: 0, turn: false, cds: { atk: 0, shd: 0 } };
        let enemy = { hp: 1500, mhp: 1500 };

        function login() {
            if(btoa(document.getElementById('pass-field').value) === _0xPASS) {
                moveScreen(1);
                updatePanel('map');
            } else { alert("خطأ!"); }
        }

        function updatePanel(type) {
            const content = document.getElementById('panel-content');
            if(type === 'map') {
                content.innerHTML = `
                    <h3 style="color: gold;">رخصة المغامر</h3>
                    <p>الاسم: ديابلو</p>
                    <p>الذهب: ${state.gold}</p>
                    <p>البنك: ${state.bank}</p>
                `;
            } else {
                content.innerHTML = `
                    <h3 style="color: red;">بطاقة المهارات</h3>
                    <div class="skill-item" onclick="useSkill('atk')">نهاية العالم (هجوم) <span class="cooldown" id="cd-atk"></span></div>
                    <div class="skill-item" onclick="useSkill('shd')">حاجز الهاوية (تعزيز) <span class="cooldown" id="cd-shd"></span></div>
                    <div class="skill-item" onclick="useSkill('mind')">العالم الوهمي (تحكم)</div>
                `;
            }
        }

        function moveScreen(index) {
            document.getElementById('game-container').style.transform = `translateX(${index * 100}vw)`;
        }

        function goToBattle() {
            moveScreen(2);
            updatePanel('battle');
            log("ديابلو واجه غيوتارو في ساحة المعركة!");
            enemy.hp = 1500; updateBattleUI();
        }

        function backToMap() {
            moveScreen(1);
            updatePanel('map');
        }

        function useSkill(skill) {
            if(state.turn) return;
            if(skill === 'atk' && state.cds.atk === 0) {
                enemy.hp -= 400; state.cds.atk = 2;
                log("ديابلو: نهاية العالم! (400 ضرر)");
            } else if(skill === 'shd' && state.cds.shd === 0) {
                log("ديابلو: حاجز الهاوية مفعل!");
                state.cds.shd = 3;
            } else { return; }

            state.turn = true;
            updateBattleUI();
            if(enemy.hp <= 0) return win();
            setTimeout(enemyTurn, 1000);
        }

        function enemyTurn() {
            let dmg = 150;
            state.hp -= dmg;
            log(`غيوتارو: هجوم ماندالا الدم (${dmg} ضرر)`);
            if(state.cds.atk > 0) state.cds.atk--;
            if(state.cds.shd > 0) state.cds.shd--;
            state.turn = false;
            updateBattleUI();
            updatePanel('battle');
        }

        function updateBattleUI() {
            document.getElementById('p-hp').style.width = (state.hp / 10) + "%";
            document.getElementById('e-hp').style.width = (enemy.hp / 15) + "%";
            document.getElementById('p-hp-txt').innerText = state.hp + "/1000";
            document.getElementById('e-hp-txt').innerText = enemy.hp + "/1500";
            
            const cdA = document.getElementById('cd-atk');
            const cdS = document.getElementById('cd-shd');
            if(cdA) cdA.innerText = state.cds.atk > 0 ? state.cds.atk : "";
            if(cdS) cdS.innerText = state.cds.shd > 0 ? state.cds.shd : "";
        }

        function log(m) {
            const l = document.getElementById('battle-log');
            l.innerHTML = `<div>• ${m}</div>` + l.innerHTML;
        }

        function win() { alert("نصر ساحق!"); state.gold += 200; backToMap(); }
    </script>
</body>
</html>
